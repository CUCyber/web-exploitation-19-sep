FROM nginx:latest AS web-exploitation-6-sep

# Nginx server
COPY server.conf /etc/nginx/conf.d/default.conf
COPY html /var/www/html

# SSH server
RUN apt-get update && apt-get install -y openssh-server \
    && mkdir -p /var/run/sshd
RUN sed -i 's/^PermitRootLogin prohibit-password/PermitRootLogin yes/;s/#Port 22/Port 49152/' /etc/ssh/sshd_config
COPY html/id_ed25519.pub /root/.ssh/authorized_keys
EXPOSE 49152

CMD service ssh start && nginx -g 'daemon off;'
